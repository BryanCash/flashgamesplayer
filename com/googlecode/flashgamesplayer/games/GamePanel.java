/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * flash.java
 *
 * Created on 18 Ιουν 2010, 1:47:58 μμ
 */
package com.googlecode.flashgamesplayer.games;

import chrriis.dj.nativeswing.swtimpl.components.JFlashPlayer;
import java.awt.BorderLayout;
import java.sql.SQLException;
import java.util.logging.Level;
import com.googlecode.flashgamesplayer.FlashGamesPlayer;
import com.googlecode.flashgamesplayer.database.Game;
import com.googlecode.flashgamesplayer.database.Genre;
import com.googlecode.flashgamesplayer.database.Options;
import java.awt.Color;
import java.awt.Font;

/**
 *
 * @author ssoldatos
 */
public class GamePanel extends javax.swing.JPanel {

  private JFlashPlayer flashPlayer;
  private Game game;
  private int genre_id;
  private static int dividerLocation;

  /** Creates new form flash */
  public GamePanel() {
    super(new BorderLayout());
    flashPlayer = new JFlashPlayer();
    add(flashPlayer, BorderLayout.CENTER);
  }

  public void setGame(Game game) {
    setGame(game, true);
  }

  public void setGame(Game game, boolean play) {
    if (game == null) {
      this.game = new Game();
      getFlashPlayer().load(null);
    } else {
      this.game = game;
    }
    //if (getFlashPlayer() != null) {
    //  remove(getFlashPlayer());
    //}

    try {
      if (game != null && this.game.getDeleted() == 0 && play) {
        getFlashPlayer().load(Options.USER_DIR + Options.GAMES_DIR + this.game.getFilename());
        game.setPlayed(this.game.getId());
      }
    } catch (Exception ex) {
    }
//    add(getFlashPlayer(), BorderLayout.CENTER);
    validate();
    //this.genre_id = this.game.getGenre_id();
    FlashGamesPlayer.label_gameTitle.setText(this.game.getTitle());
    FlashGamesPlayer.rating.setRate(this.game.getRate());
    FlashGamesPlayer.rating.setRatingEnabled(true);
    FlashGamesPlayer.tf_plays.setText(String.valueOf(this.game.getPlayed() + 1));
    FlashGamesPlayer.bt_savePassword.setEnabled(game != null);
    FlashGamesPlayer.tf_password.setText(this.game.getPassword());
    FlashGamesPlayer.tf_password.setForeground(Color.black);
    FlashGamesPlayer.tf_password.setFont(FlashGamesPlayer.tf_password.getFont().deriveFont(Font.PLAIN));
    FlashGamesPlayer.bt_delete.setEnabled(game != null && game.getDeleted() == 0);
    FlashGamesPlayer.bt_editGame.setEnabled(game != null && game.getDeleted() == 0);
    FlashGamesPlayer.bt_stop.setEnabled(game != null && game.getDeleted() == 0);
    FlashGamesPlayer.menuItem_deleteGame.setEnabled(game != null && game.getDeleted() == 0);
    FlashGamesPlayer.menuItem_editGame.setEnabled(game != null && game.getDeleted() == 0);
    FlashGamesPlayer.menuItem_stopGame.setEnabled(game != null && game.getDeleted() == 0);
    FlashGamesPlayer.bt_restore.setEnabled(game != null && game.getDeleted() == 1);
    FlashGamesPlayer.menuItem_restoreGame.setEnabled(game != null && game.getDeleted() == 1);
    if (game != null && play) {
      GamePanel.dividerLocation = FlashGamesPlayer.splitpane.getDividerLocation();
      FlashGamesPlayer.splitpane.setDividerLocation(0);
    } else if(game==null){
      FlashGamesPlayer.splitpane.setDividerLocation(GamePanel.dividerLocation);
    }
  }

  public Game getGame() {
    return game;
  }

  public Genre getGenre() {
    return Genre.getGenreById(this.genre_id);
  }

  public JFlashPlayer getFlashPlayer() {
    return this.flashPlayer;
  }

  /** This method is called from within the constructor to
   * initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is
   * always regenerated by the Form Editor.
   */
  @SuppressWarnings("unchecked")
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    setLayout(new java.awt.BorderLayout());
  }// </editor-fold>//GEN-END:initComponents

  public void init() {
    FlashGamesPlayer.gamePanel.setGame(null);
    FlashGamesPlayer.label_gameTitle.setText("");
    FlashGamesPlayer.rating.setRate(0.0);
    FlashGamesPlayer.rating.setRatingEnabled(false);
    FlashGamesPlayer.tf_plays.setText("0");
    FlashGamesPlayer.gamesTree.populateTree();
  }
  // Variables declaration - do not modify//GEN-BEGIN:variables
  // End of variables declaration//GEN-END:variables
}
